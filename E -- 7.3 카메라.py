#!/usr/bin/env python
# coding: utf-8

# In[1]:


# í•„ìš”í•œ íŒ¨í‚¤ì§€ import í•˜ê¸°
import os # í™˜ê²½ ë³€ìˆ˜ë‚˜ ë””ë ‰í„°ë¦¬, íŒŒì¼ ë“±ì˜ OS ìì›ì„ ì œì–´í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ëª¨ë“ˆ
import cv2 # OpenCVë¼ì´ë¸ŒëŸ¬ë¦¬ â†’ ì»´í“¨í„° ë¹„ì „ ê´€ë ¨ í”„ë¡œê·¸ë˜ë°ì„ ì‰½ê²Œ í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
import matplotlib.pyplot as plt # ë‹¤ì–‘í•œ ë°ì´í„°ë¥¼ ë§ì€ ë°©ë²•ìœ¼ë¡œ ë„ì‹í™” í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
import numpy as np # ë‹¤ì°¨ì› ë°°ì—´ì„ ì‰½ê²Œ ì²˜ë¦¬í•˜ê³  íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
import dlib # ì´ë¯¸ì§€ ì²˜ë¦¬ ë° ê¸°ê³„ í•™ìŠµ, ì–¼êµ´ì¸ì‹ ë“±ì„ í•  ìˆ˜ ìˆëŠ” c++ ë¡œ ê°œë°œëœ ê³ ì„±ëŠ¥ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ 


# iamges and models

# In[2]:


my_image_path = 'aiffel/camera_sticker/images/shin.png' # ë³¸ì¸ ì´ë¯¸ì§€ê°€ ìˆëŠ” ê²½ë¡œë¥¼ ê°€ì§€ê³  ì˜¨ë‹¤.
img_bgr = cv2.imread(my_image_path)    # OpenCVë¡œ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤
img_show = img_bgr.copy()      # ì¶œë ¥ìš© ì´ë¯¸ì§€ë¥¼ ë”°ë¡œ ë³´ê´€í•©ë‹ˆë‹¤
plt.imshow(img_bgr) # ì´ë¯¸ì§€ë¥¼ ì¶œë ¥í•˜ê¸° ìœ„í•´ ì¶œë ¥í•  ì´ë¯¸ì§€ë¥¼ ì˜¬ë ¤ì¤€ë‹¤. (ì‹¤ì œ ì¶œë ¥ì€ í•˜ì§€ ì•ŠìŒ)
plt.show() # ì´ë¯¸ì§€ë¥¼ ì¶œë ¥í•´ì¤€ë‹¤. (ì‹¤ì œ ì¶œë ¥)


# In[3]:


# detectorë¥¼ ì„ ì–¸í•©ë‹ˆë‹¤
detector_hog = dlib.get_frontal_face_detector() # ê¸°ë³¸ ì–¼êµ´ ê°ì§€ê¸°ë¥¼ ë°˜í™˜
print("ğŸŒ«ğŸ›¸")


# In[4]:


img_rgb = cv2.cvtColor(img_bgr, cv2.COLOR_BGR2RGB)
dlib_rects = detector_hog(img_rgb, 1)   # (image, num of image pyramid)
print("ğŸŒ«ğŸ›¸")


# Face landmark

# In[5]:


# ì°¾ì€ ì–¼êµ´ ì˜ì—­ ë°•ìŠ¤ ë¦¬ìŠ¤íŠ¸
# ì—¬ëŸ¬ ì–¼êµ´ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤
print(dlib_rects)   

for dlib_rect in dlib_rects: # ì°¾ì€ ì–¼êµ´ ì˜ì—­ì˜ ì¢Œí‘œ
    l = dlib_rect.left() # ì™¼ìª½
    t = dlib_rect.top() # ìœ„ìª½
    r = dlib_rect.right() # ì˜¤ë¥¸ìª½
    b = dlib_rect.bottom() # ì•„ë˜ìª½

    cv2.rectangle(img_show, (l,t), (r,b), (0,255,0), 2, lineType=cv2.LINE_AA) # ì‹œì‘ì ì˜ ì¢Œí‘œì™€ ì¢…ë£Œì  ì¢Œí‘œë¡œ ì§ê° ì‚¬ê°í˜•ì„ ê·¸ë¦¼

img_show_rgb =  cv2.cvtColor(img_show, cv2.COLOR_BGR2RGB)
plt.imshow(img_show_rgb)
plt.show()


# In[ ]:





# Landmark localization

# In[6]:


model_path = 'aiffel/camera_sticker/models/shape_predictor_68_face_landmarks.dat'
    # ì €ì¥í•œ landmark ëª¨ë¸ì˜ ì£¼ì†Œë¥¼ model_path ë³€ìˆ˜ì— ì €ì¥
landmark_predictor = dlib.shape_predictor(model_path)
    # dlib ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ shape_predictor í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ ëª¨ë¸ì„ ë¶ˆëŸ¬ì˜´
    # landmark_predictorëŠ” RGBì´ë¯¸ì§€ì™€ dlib.rectangleë¥¼ ì…ë ¥ ë°›ê³  dlib.full_object_detectionë¥¼ ë°˜í™˜
    # dlib.rectangle: ë‚´ë¶€ë¥¼ ì˜ˆì¸¡í•˜ëŠ” ë°•ìŠ¤
    # dlib.full_object_detection: ê° êµ¬ì„± ìš”ì†Œì˜ ìœ„ì¹˜ì™€, ì´ë¯¸ì§€ ìƒì˜ ê°ì²´ì˜ ìœ„ì¹˜ë¥¼ ë‚˜íƒ€ëƒ„
print("ğŸŒ«ğŸ›¸")


# In[7]:


list_landmarks = []
    # ëœë“œë§ˆí¬ì˜ ìœ„ì¹˜ë¥¼ ì €ì¥í•  list ìƒì„±    

# ì–¼êµ´ ì˜ì—­ ë°•ìŠ¤ ë§ˆë‹¤ face landmarkë¥¼ ì°¾ì•„ëƒ…ë‹ˆë‹¤
# face landmark ì¢Œí‘œë¥¼ ì €ì¥í•´ë‘¡ë‹ˆë‹¤
for dlib_rect in dlib_rects:
    points = landmark_predictor(img_rgb, dlib_rect)
        # ëª¨ë“  landmarkì˜ ìœ„ì¹˜ì •ë³´ë¥¼ points ë³€ìˆ˜ì— ì €ì¥
    list_points = list(map(lambda p: (p.x, p.y), points.parts()))
        # ê°ê°ì˜ landmark ìœ„ì¹˜ì •ë³´ë¥¼ (x,y) í˜•íƒœë¡œ ë³€í™˜í•˜ì—¬ list_points ë¦¬ìŠ¤íŠ¸ë¡œ ì €ì¥
    list_landmarks.append(list_points)
        # list_landmarksì— ëœë“œë§ˆí¬ ë¦¬ìŠ¤íŠ¸ë¥¼ ì €ì¥

print(len(list_landmarks[0]))
    # ì–¼êµ´ì´ nê°œì¸ ê²½ìš° list_landmarksëŠ” nê°œì˜ ì›ì†Œë¥¼ ê°–ê³ 
    # ê° ì›ì†ŒëŠ” 68ê°œì˜ ëœë“œë§ˆí¬ ìœ„ì¹˜ê°€ ë‚˜ì—´ëœ list 
    # list_landmarksì˜ ì›ì†Œê°€ 1ê°œì´ë¯€ë¡œ list_landmarks[1]ì„ í˜¸ì¶œí•˜ë©´ IndexErrorê°€ ë°œìƒ


# hog detector

# In[8]:


# list_landmarksì˜ ì›ì†Œê°€ 1ê°œì´ë¯€ë¡œ ì•„ë˜ ë°˜ë³µë¬¸ì€ í•œë²ˆë§Œ ì‹¤í–‰ë¨
for landmark in list_landmarks:
    for point in landmark:
        cv2.circle(img_show, point, 2, (0, 255, 255), -1)
            # cv2.circle: OpenCVì˜ ì›ì„ ê·¸ë¦¬ëŠ” í•¨ìˆ˜
            # img_show ì´ë¯¸ì§€ ìœ„ ê°ê°ì˜ pointì—
            # í¬ê¸°ê°€ 2ì´ê³  (0, 255, 255)ìƒ‰ìœ¼ë¡œ ë‚´ë¶€ê°€ ì±„ì›Œì§„(-1) ì›ì„ ê·¸ë¦¼
            # (ë§ˆì§€ë§‰ ì¸ìˆ˜ê°€ ìì—°ìˆ˜ë¼ë©´ ê·¸ë§Œí¼ì˜ ë‘ê»˜ì˜ ì„ ìœ¼ë¡œ ì›ì´ ê·¸ë ¤ì§)

img_show_rgb = cv2.cvtColor(img_show, cv2.COLOR_BGR2RGB)
    # RGB ì´ë¯¸ì§€ë¡œ ì „í™˜
plt.imshow(img_show_rgb)
    # ì´ë¯¸ì§€ë¥¼ ì¤€ë¹„
plt.show()
    # ì´ë¯¸ì§€ë¥¼ ì¶œë ¥


# In[15]:


# zip() : ë‘ ê·¸ë£¹ì˜ ë°ì´í„°ë¥¼ ì„œë¡œ ì—®ì–´ì£¼ëŠ” íŒŒì´ì¬ì˜ ë‚´ì¥ í•¨ìˆ˜
# dlib_rectsì™€ list_landmarks ë°ì´í„°ë¥¼ ì—®ì–´ ì£¼ì—ˆìŒ
# dlib_rects : ì–¼êµ´ ì˜ì—­ì„ ì €ì¥í•˜ê³  ìˆëŠ” ê°’
# â†’ rectangles[[(345, 98) (531, 284)]]
# list_landmarks : 68ê°œì˜ ëœë“œë§ˆí¬ ê°’ ì €ì¥(ì´ëª©êµ¬ë¹„ ìœ„ì¹˜(x,y))
# â†’ [[(368, 153), (368, 174), (371, 195), (376, 215), (382, 235), (391, 252), (404, 266), (420, 277), (441, 279), (461, 276), (480, 266), (495, 252), (508, 235), (516, 216), (520, 195), (523, 173), (524, 151), (377, 131), (386, 119), (399, 116), (413, 118), (425, 124), (454, 121), (466, 114), (481, 112), (494, 114), (503, 127), (439, 143), (438, 156), (438, 169), (437, 182), (423, 197), (431, 199), (438, 200), (446, 199), (454, 197), (391, 147), (399, 142), (409, 143), (416, 149), (408, 150), (399, 150), (464, 147), (472, 141), (482, 141), (489, 145), (482, 149), (473, 149), (411, 227), (421, 222), (432, 218), (439, 220), (446, 218), (458, 222), (471, 227), (458, 234), (446, 238), (438, 238), (431, 238), (420, 235), (415, 227), (432, 227), (439, 228), (447, 227), (466, 227), (446, 228), (438, 229), (431, 228)]]

for dlib_rect, landmark in zip(dlib_rects, list_landmarks): # ì–¼êµ´ ì˜ì—­ì„ ì €ì¥í•˜ê³  ìˆëŠ” ê°’ê³¼ 68ê°œì˜ ëœë“œë§ˆí¬ë¥¼ ì €ì¥í•˜ê³  ìˆëŠ” ê°’ìœ¼ë¡œ ë°˜ë³µë¬¸ ì‹¤í–‰
    print (landmark[30]) # ì½”ì˜ indexëŠ” 30 ì…ë‹ˆë‹¤
    x = landmark[30][0] # ì´ë¯¸ì§€ì—ì„œ ì½” ë¶€ìœ„ì˜ xê°’
    y = landmark[30][1] # - dlib_rect.height()//2 # ì´ë¯¸ì§€ì—ì„œ ì½” ë¶€ìœ„ì˜ yê°’ - ì–¼êµ´ ì˜ì—­ì˜ ì„¸ë¡œë¥¼ ì°¨ì§€í•˜ëŠ” í”½ì…€ì˜ ìˆ˜//2 â†’ (437, 182-(186+1//2))
    w = h = dlib_rect.width() # ì–¼êµ´ ì˜ì—­ì˜ ê°€ë¡œë¥¼ ì°¨ì§€í•˜ëŠ” í”½ì…€ì˜ ìˆ˜ (531-345+1) â†’ max(x) - min(x) +1(í”½ì…€ì˜ ìˆ˜ ì´ê¸° ë•Œë¬¸ì— 1ì„ ë”í•´ì¤Œ â†’ í”½ì…€ ìˆ˜ëŠ” ì  í•˜ë‚˜ë¡œë„ 1ì´ ë¨)
    print (f'(x,y) : ({x},{y})')
    print (f'(w,h) : ({w},{h})')


# Cat whiskers

# In[16]:


sticker_path = os.getenv('HOME')+'/aiffel/camera_sticker/images/cat-whiskers.png' # ê³ ì–‘ì´ ìˆ˜ì—¼ ì´ë¯¸ì§€ì˜ ê²½ë¡œ
img_sticker = cv2.imread(sticker_path) # ìŠ¤í‹°ì»¤ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤ // cv2.imread(ì´ë¯¸ì§€ ê²½ë¡œ) â†’ imageê°ì²´ í–‰ë ¬ì„ ë°˜í™˜
img_sticker = cv2.resize(img_sticker, (w,h)) # ìŠ¤í‹°ì»¤ ì´ë¯¸ì§€ ì¡°ì • â†’ w,hëŠ” ì–¼êµ´ ì˜ì—­ì˜ ê°€ë¡œë¥¼ ì°¨ì§€í•˜ëŠ” í”½ì…€ì˜ ìˆ˜(187) // cv2.resize(imageê°ì²´ í–‰ë ¬, (ê°€ë¡œ ê¸¸ì´, ì„¸ë¡œ ê¸¸ì´))
print (img_sticker.shape) # ì‚¬ì´ì¦ˆë¥¼ ì¡°ì •í•œ ì™•ê´€ ì´ë¯¸ì§€ì˜ ì°¨ì› í™•ì¸


# In[17]:


# x,y,w,h ëª¨ë‘ ìœ„ì—ì„œ ë°˜ë³µë¬¸ ì•ˆì—ì„œ ì§€ì •í•´ì¤€ ê°’ì„
# xëŠ” ì´ë¯¸ì§€ì—ì„œ ì½” ë¶€ìœ„ì˜ xê°’ = 437
# yëŠ” ì´ë¯¸ì§€ì—ì„œ ì½” ë¶€ìœ„ì˜ yê°’ = 89
# wëŠ” ì–¼êµ´ ì˜ì—­ì˜ ê°€ë¡œë¥¼ ì°¨ì§€í•˜ëŠ” í”½ì…€ì˜ ìˆ˜ = 187
# hëŠ” ì–¼êµ´ ì˜ì—­ì˜ ê°€ë¡œë¥¼ ì°¨ì§€í•˜ëŠ” í”½ì…€ì˜ ìˆ˜ = 187
refined_x = x - w // 2 # 437 - (187//2) = 437-93 = 344
refined_y = y - h//2 # 89-187 = -98
# ì›ë³¸ ì´ë¯¸ì§€ì— ìŠ¤í‹°ì»¤ ì´ë¯¸ì§€ë¥¼ ì¶”ê°€í•˜ê¸° ìœ„í•´ì„œ x, y ì¢Œí‘œë¥¼ ì¡°ì •í•©ë‹ˆë‹¤. ì´ë¯¸ì§€ ì‹œì‘ì ì€ top-left ì¢Œí‘œì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
# ì¦‰, refined_x, refined_yê°’ì—ì„œ ì™•ê´€ ì´ë¯¸ì§€ê°€ ì‹œì‘ë¨
print (f'(x,y) : ({refined_x},{refined_y})') # ìŒìˆ˜ ë°œìƒ : ì´ë¯¸ì§€ ë²”ìœ„ë¥¼ ë²—ì–´ë‚¨
# ìš°ë¦¬ëŠ” í˜„ì¬ ì´ë§ˆ ìë¦¬ì— ì™•ê´€ì„ ë‘ê³  ì‹¶ì€ê±´ë°, ì´ë§ˆìœ„ì¹˜ - ì™•ê´€ ë†’ì´ë¥¼ í–ˆë”ë‹ˆ ì´ë¯¸ì§€ì˜ ë²”ìœ„ë¥¼ ì´ˆê³¼í•˜ì—¬ ìŒìˆ˜ê°€ ë‚˜ì˜¤ëŠ” ê²ƒ
# opencvëŠ” ndarrayë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ”ë°, ndarrayëŠ” ìŒìˆ˜ì¸ë±ìŠ¤ì— ì ‘ê·¼ ë¶ˆê°€í•˜ë¯€ë¡œ ìŠ¤í‹°ì»¤ ì´ë¯¸ì§€ë¥¼ ì˜ë¼ ì¤˜ì•¼ í•œë‹¤.


# In[18]:


# ì™•ê´€ ì´ë¯¸ì§€ê°€ ì´ë¯¸ì§€ ë°–ì—ì„œ ì‹œì‘í•˜ì§€ ì•Šë„ë¡ ì¡°ì •ì´ í•„ìš”í•¨
# ì¢Œí‘œ ìˆœì„œê°€ y,xì„ì— ìœ ì˜í•œë‹¤. (y,x,rgb channel)
# í˜„ì¬ ìƒí™©ì—ì„œëŠ” -y í¬ê¸°ë§Œí¼ ìŠ¤í‹°ì»¤ë¥¼ crop í•˜ê³ , top ì˜ xì¢Œí‘œì™€ y ì¢Œí‘œë¥¼ ê°ê°ì˜ ê²½ìš°ì— ë§ì¶° ì›ë³¸ ì´ë¯¸ì§€ì˜ ê²½ê³„ ê°’ìœ¼ë¡œ ìˆ˜ì •í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ë‚˜ì˜µë‹ˆë‹¤.
# ìŒìˆ˜ê°’ ë§Œí¼ ê³ ì–‘ì´ ìˆ˜ì—¼ ì´ë¯¸ì§€(í˜¹ì€ ì¶”í›„ ì ìš©í•  ìŠ¤í‹°ì»¤ ì´ë¯¸ì§€)ë¥¼ ìë¥¸ë‹¤.
if refined_x < 0: 
    img_sticker = img_sticker[:, -refined_x:]
    refined_x = 0
# ê³ ì–‘ì´ ìˆ˜ì—¼ ì´ë¯¸ì§€ë¥¼ ì”Œìš°ê¸° ìœ„í•´ ê³ ì–‘ì´ ìˆ˜ì—¼ ì´ë¯¸ì§€ê°€ ì‹œì‘í•  yì¢Œí‘œ ê°’ ì¡°ì •
if refined_y < 0:
    img_sticker = img_sticker[-refined_y:, :] # refined_yê°€ -98ì´ë¯€ë¡œ, img_sticker[98: , :]ê°€ ëœë‹¤. (187, 187, 3)ì—ì„œ (89, 187, 3)ì´ ë¨ (187ê°œ ì¤‘ì—ì„œ 98ê°œê°€ ì˜ë ¤ë‚˜ê°)
    refined_y = 0

print (f'(x,y) : ({refined_x},{refined_y})')


# In[19]:


# sticker_areaëŠ” ì›ë³¸ì´ë¯¸ì§€ì—ì„œ ìŠ¤í‹°ì»¤ë¥¼ ì ìš©í•  ìœ„ì¹˜ë¥¼ cropí•œ ì´ë¯¸ì§€ ì…ë‹ˆë‹¤.
# ì˜ˆì œì—ì„œëŠ” (344,0) ë¶€í„° (344+187, 0+89) ë²”ìœ„ì˜ ì´ë¯¸ì§€ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
# ì¢Œí‘œ ìˆœì„œê°€ y,xì„ì— ìœ ì˜í•œë‹¤. (y,x,rgb channel)
# img_show[refined_y:refined_y+img_sticker.shape[0], refined_x:refined_x+img_sticker.shape[1]]
# img_show[0:0+89, 344:344+187]
# img_show[0:89, 344:531]
# ì¦‰, xì¢Œí‘œëŠ” 344~531 / yì¢Œí‘œëŠ” 0~89ê°€ ë¨
sticker_area = img_show[refined_y:refined_y+img_sticker.shape[0], refined_x:refined_x+img_sticker.shape[1]]
# ê³ ì–‘ì´ ìˆ˜ì—¼ ì´ë¯¸ì§€ì—ì„œ ì‚¬ìš©í•  ë¶€ë¶„ì€ 0ì´ ì•„ë‹Œ ìƒ‰ì´ ìˆëŠ” ë¶€ë¶„ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
# ê³ ì–‘ì´ ìˆ˜ì—¼ ì´ë¯¸ì§€ì—ì„œ 0ì´ ë‚˜ì˜¤ëŠ” ë¶€ë¶„ì€ í°ìƒ‰ì´ë¼ëŠ” ëœ», ì¦‰ ì´ë¯¸ì§€ê°€ ì—†ë‹¤ëŠ” ì†Œë¦¬ì„.
# í˜„ì¬ ê³ ì–‘ì´ ìˆ˜ì—¼ ì´ë¯¸ì§€ì—ì„œëŠ” ê³ ì–‘ì´ ìˆ˜ì—¼ì˜ ------ ë¶€ë¶„ì´ ë¨
# ê·¸ë ‡ê¸° ë•Œë¬¸ì— 0ì¸ ë¶€ë¶„(ì´ë¯¸ì§€ê°€ ì—†ëŠ” ë¶€ë¶„)ì€ ì œì™¸í•˜ê³  ì ìš©
# sticker_areaëŠ” ì›ë³¸ ì´ë¯¸ì§€ì—ì„œ ìŠ¤í‹°ì»¤ë¥¼ ì ìš©í•  ìœ„ì¹˜ë¥¼ ë¯¸ë¦¬ ì˜ë¼ë‚¸ ì´ë¯¸ì§€ì…ë‹ˆë‹¤.
# ì¦‰, ê³ ì–‘ì´ ìˆ˜ì—¼ ì´ë¯¸ì§€ì—ì„œ ê³ ì–‘ì´ ìˆ˜ì—¼ ì´ë¯¸ì§€ê°€ ì—†ëŠ” ë¶€ë¶„(ê³ ì–‘ì´ ìˆ˜ì—¼ì˜ ------ ë¶€ë¶„)ì€ ì›ë³¸ ì´ë¯¸ì§€ì—ì„œ ë¯¸ë¦¬ ì˜ë¼ë†“ì€ sticker_area(ìŠ¤í‹°ì»¤ ì ìš©í•  ë¶€ë¶„ ë§Œí¼ ì›ë³¸ ì´ë¯¸ì§€ì—ì„œ ìë¥¸ ì´ë¯¸ì§€)ë¥¼ ì ìš©í•˜ê³ ,
# ë‚˜ë¨¸ì§€ ë¶€ë¶„ì€ ìŠ¤í‹°ì»¤ë¡œ ì±„ì›Œì£¼ë©´ ë¨
# np.whereëŠ” ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” ì¸ë±ìŠ¤ë§Œ ì°¾ì•„ì„œ ê°’ì„ ì ìš©í•˜ëŠ” ë°©ë²•ì´ë‹¤.
# ì•„ë˜ ì½”ë“œì—ì„œëŠ” img_stickerê°€ 0ì¼ ê²½ìš°(ì™•ê´€ ì´ë¯¸ì§€ì—ì„œ ê³ ì–‘ì´ ìˆ˜ì—¼ ë¶€ë¶„ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ì´ë¯¸ì§€)ì—ëŠ” sticker_area(ì›ë³¸ ì´ë¯¸ì§€ì—ì„œ ìŠ¤í‹°ì»¤ë¥¼ ì ìš©í•  ìœ„ì¹˜ë¥¼ ë¯¸ë¦¬ ì˜ë¼ë‚¸ ì´ë¯¸ì§€)ë¥¼ ì ìš©í•˜ê³ ,
# ë‚˜ë¨¸ì§€ ë¶€ë¶„ì€ img_sticker(ê³ ì–‘ì´ ìˆ˜ì—¼ ì´ë¯¸ì§€)ë¥¼ ì ìš©í•œë‹¤.
img_show[refined_y:refined_y+img_sticker.shape[0], refined_x:refined_x+img_sticker.shape[1]] =     np.where(img_sticker==255,sticker_area,img_sticker).astype(np.uint8)
print("ìŠ~")


# In[20]:


# ê³ ì–‘ì´ ìˆ˜ì—¼ ì´ë¯¸ì§€ë¥¼ ì ìš©í•œ ì´ë¯¸ì§€ë¥¼ ë³´ì—¬ì¤€ë‹¤.
# ì–¼êµ´ ì˜ì—­(7-3)ê³¼ ëœë“œë§ˆí¬(7-4)ë¥¼ ë¯¸ë¦¬ ì ìš©í•´ë†“ì€ img_showì— ì™•ê´€ ì´ë¯¸ì§€ë¥¼ ë§ë¶™ì¸ ì´ë¯¸ì§€ê°€ ë‚˜ì˜¤ê²Œ ëœë‹¤.)
plt.imshow(cv2.cvtColor(img_show, cv2.COLOR_BGR2RGB))
plt.show()


# In[21]:


# ìœ„ì—ì„œ ì„¤ëª…í–ˆìœ¼ë¯€ë¡œ ìƒëµ
# ê³ ì–‘ì´ ìˆ˜ì—¼ ì´ë¯¸ì§€
sticker_area = img_bgr[refined_y:refined_y +img_sticker.shape[0], refined_x:refined_x+img_sticker.shape[1]]
# img_bgrì€ 7-2ì—ì„œ rgbë¡œë§Œ ì ìš©í•´ë†“ì€ ì›ë³¸ ì´ë¯¸ì§€ì´ë‹¤. 
img_bgr[refined_y:refined_y +img_sticker.shape[0], refined_x:refined_x+img_sticker.shape[1]] =     np.where(img_sticker==255,sticker_area,img_sticker).astype(np.uint8)
plt.imshow(cv2.cvtColor(img_bgr, cv2.COLOR_BGR2RGB)) # rgbë§Œ ì ìš©í•´ë†“ì€ ì›ë³¸ ì´ë¯¸ì§€ì— ê³ ì–‘ì´ ìˆ˜ì—¼ ì´ë¯¸ì§€ë¥¼ ë®ì–´ ì”Œìš´ ì´ë¯¸ì§€ê°€ ë‚˜ì˜¤ê²Œ ëœë‹¤.
plt.show()


# íšŒê³  
# ê°’ ã…‡ ì„ 255 ë¡œ 
# h// 2 
# king.png ë¥¼ cat-whiskers.png ë¡œ
# ì‚¬ì§„ì„ shin.png ë¡œ í•˜ì—¬ 
# ê³ ì–‘ì´ ìˆ˜ì—¼ì„ ë¶™ì˜€ìŠµë‹ˆë‹¤.
# ì£¼ìœ„ ë§ì€ ë¶„ë“¤ì„ í†µí•´ ì—¬ê¸° ê¹Œì§€ ì™”ìŠµë‹ˆë‹¤.
# ê°ì‚¬í•©ë‹ˆë‹¤
# ì§€ìˆ˜ë‹˜ ê´‘ì„ë‹˜ ì¢…ì¸ë‹˜ ì„±ì¤€ë‹˜ ë“± ë§ì€ ë¶„ë“¤ì˜ ë„ì›€ì„ ì–»ì—ˆì—ˆìŠµë‹ˆë‹¤. 
# í¼ì‹¤ë‹˜ë“¤ì€ ë”ë”ìš± ê°ì‚¬ë“œë¦½ë‹ˆë‹¤.

# reference 
# https://lms.aiffel.io/course/357/node/503/step/3426

# In[ ]:




